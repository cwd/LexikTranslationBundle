parameters:
    kphoen.state_machine.listener.callbacks.class: Aspetos\Service\Listener\StatefulEntitiesCallbacksListener

services:
    # aliases for auto-wiring
    container: @service_container
    em: @doctrine.orm.entity_manager
    entity_manager: @doctrine.orm.entity_manager
    legacy_entity_manager: @doctrine.orm.legacy_entity_manager
    dispatcher: @event_dispatcher
    security: @security.context
    token_storage: @security.token_storage

    aspetos_role_hierarchy:
        alias: security.role_hierarchy

    aspetos.service.authorization.voter.is_owner_with_permission_or_admin:
        class: Aspetos\Service\Authorization\Voter\IsOwnerWithPermissionOrAdminVoter
        tags:
            - { name: security.voter }
        arguments: ["@aspetos_role_hierarchy", "@aspetos.service.permission"]

    ajax.authlistener:
        class: Aspetos\Service\Listener\AjaxAuthenticationListener
        tags:
          - { name: kernel.event_listener, event: kernel.exception, method: onCoreException, priority: 255 }

    # Overwrite with event trigger
    kphoen.state_machine.listener.callbacks:
        class:      %kphoen.state_machine.listener.callbacks.class%
        tags:
            - { name: kernel.event_subscriber }
        arguments: ["@event_dispatcher"]

    aspetos.listener.translation.insert:
        class:  Aspetos\Service\Listener\TranslationInsertListener
        arguments: ["@lexik_translation.trans_unit.manager", "@translator", "@lexik_translation.translation_storage", "%kernel.debug%"]
        tags:
          - { name: kernel.event_listener, event: kernel.terminate, method: onTerminate, priority: -20 }
